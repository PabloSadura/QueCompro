<div class="container my-4">
  <h2 class="mb-4 text-center">Historial de Búsquedas</h2>

  @if (loading) {
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando tu historial...</p>
    </div>
  }

  @if (error) {
    <div class="alert alert-danger">{{ error }}</div>
  }

  <!-- Solo mostramos la lista si no está cargando y no hay errores -->
  @if (!loading && !error) {
    @if (history.length > 0) {
      <div class="row d-flex justify-content-center">
        <!-- Columna para la lista del historial -->
        <div class="col-md-4">
  <h5 class="mb-3">Tus búsquedas</h5>

  <!-- Contenedor con scroll -->
  <div class="list-group history-scroll" data-bs-scroll="true">
    @for (item of history; track item.id) {
      <button 
        type="button" 
        class="list-group-item list-group-item-action text-start"
        [class.active]="item.id === selectedHistoryItem?.id"
        (click)="showHistoryDetails(item)">
        
        <div class="d-flex w-100 justify-content-between">
          <h6 class="mb-1 text-truncate" [title]="item.query">{{ item.query }}</h6>
        </div>
        <small class="text-muted">{{ item.result.productos.length }} productos encontrados</small>
      </button>
    }
  </div>
</div>


        <!-- Columna para mostrar los resultados del item seleccionado -->
        <div class="col-md-8">
          <!-- Pasamos el objeto 'selectedHistoryItem' completo a app-results -->
          <!-- El 'searchResult' aquí es el @Input del ResultsComponent -->
          <app-results [historyResult]="selectedHistoryItem"></app-results>
        </div>
      </div>
    } @else {
      <div class="alert alert-info">No tienes historial de búsquedas.</div>
    }
  }
</div>